# Proposed firewall4 change (conceptual patch)
# Inserts guards before flow add to skip marked or NATted flows.

--- a/root/usr/share/nftables.d/ruleset-post/flowtable.nft
+++ b/root/usr/share/nftables.d/ruleset-post/flowtable.nft
@@
 chain ft {
-   flow offload @ft
+   meta mark != 0 return
+   ct status { dnat, snat } return
+   flow offload @ft
 }

# Rationale: policy-routed traffic (non-zero mark) and NAT directions rely on per-packet routing/neighbor lookups.
# Returning early keeps them in slow path, avoiding cached wrong L2 destinations observed with PBR + offload.
